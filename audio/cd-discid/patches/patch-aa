$NetBSD: patch-aa,v 1.2 2013/01/21 22:24:56 jperkin Exp $

- Add support for DragonFly
- Fix output on OSX

--- cd-discid.c.orig	2003-12-15 23:55:00.000000000 +0000
+++ cd-discid.c	2013-01-21 22:20:21.000000000 +0000
@@ -37,7 +37,7 @@
  * to compile on Solaris */
 #define cdte_track_address cdte_addr.lba
 
-#elif defined(__FreeBSD__)
+#elif defined(__FreeBSD__) || defined(__DragonFly__)
 
 #include <sys/cdio.h>
 #define        CDROM_LBA       CD_LBA_FORMAT   /* first frame is 0 */
@@ -194,7 +194,7 @@
 	 * TocEntry[last-1].lastRecordedAddress + 1, so we compute the start
 	 * of leadout from the start+length of the last track instead
 	 */
-	TocEntry[last].cdte_track_address = TocEntry[last-1].trackSize + TocEntry[last-1].trackStartAddress;
+	TocEntry[last].cdte_track_address = htonl(ntohl(TocEntry[last-1].trackSize) + ntohl(TocEntry[last-1].trackStartAddress));
 #else /* FreeBSD, Linux, Solaris */
 	for (i=0; i < last; i++) {
 		/* tracks start with 1, but I must start with 0 on OpenBSD */
@@ -214,12 +214,12 @@
 	}
 #endif
 
-#if defined(__FreeBSD__)
+#if defined(__FreeBSD__) || defined(__DragonFly__) || defined(__APPLE__)
 	TocEntry[i].cdte_track_address = ntohl(TocEntry[i].cdte_track_address);
 #endif       
 
 	for (i=0; i < last; i++) {
-#if defined(__FreeBSD__)
+#if defined(__FreeBSD__) || defined(__DragonFly__) || defined(__APPLE__)
 		TocEntry[i].cdte_track_address = ntohl(TocEntry[i].cdte_track_address);
 #endif
 		cksum += cddb_sum((TocEntry[i].cdte_track_address + CD_MSF_OFFSET) / CD_FRAMES);
